# F-Gateway プロジェクト設定

## プロジェクト概要

| 項目 | 値 |
|------|-----|
| **プロジェクト名** | F-Gateway |
| **担当者** | **Teppei** (設計者), **Komaki** (開発エンジニア) |
| **運用モード** | **DEV** |

---

## 開発サーバー設定

| 項目 | 値 |
|------|-----|
| **推奨ポート** | 3002 |
| **代替ポート** | 3003, 3004 (順次試行) |
| **禁止ポート** | 3000 (他プロジェクトとの競合防止) |

**起動方法**:
```bash
PORT=3002 npm run dev
```

---

# グローバル開発ルール（継承）

## 担当者表記ルール

| 担当者名 | 表記 | 役割 |
|---------|------|------|
| 後藤鉄兵 | **Teppei** | 設計者 |
| 小牧さん | **Komaki** | 開発エンジニア |

> **重要**: ドキュメント内では必ず上記の英語表記を使用すること。

---

## 確認メッセージの日本語化

ツール実行時にユーザー確認が必要な場合、実行前に以下の形式で日本語説明を出力すること：

```
【実行内容】○○を実行します
【対象】ファイル名やコマンド
【影響】変更内容の説明
```

---

## 安全性ルール

### ファイル操作
| 禁止 | 代替 | 理由 |
|------|------|------|
| `rm -rf` | `trash` | 復元可能にする |
| `rm -f` | `trash` | 同上 |
| `sudo rm` | 禁止 | システム破壊防止 |

### 秘密情報
- .env.local の内容は出力しない
- APIキーをコードにハードコードしない
- .env.local をGitにコミットしない

---

## 運用モード設定

| モード | 目的 | 確認頻度 |
|--------|------|---------|
| **DEV** | 開発効率優先。確認を最小限に | 少ない |
| **RELEASE** | 安全性優先。重要操作は必ず確認 | 多い |

### 現在のモード
**MODE: DEV**
<!-- MODE: RELEASE -->

### DEV モード
- **確認不要**: ファイル操作、git操作（main以外）、パッケージインストール、テスト、ビルド
- **要確認**: main/masterへのpush、本番環境操作、.env.local変更

### RELEASE モード
- **確認不要**: ファイル読み取り、git status/diff/log
- **要確認**: ファイル編集、git操作全般、デプロイ、DB変更、外部API

---

## バックアップ

**トリガー**: 「プロジェクトをバックアップしてください」

- ファイル名: `YYYYMMDD_Backup-F-Gateway_claude.zip`
- 保存先: `/Users/tep/Library/CloudStorage/GoogleDrive-goto@daq.jp/マイドライブ/Tep_archive`
- 除外: `node_modules/`, `.next/`, `.git/`

---

## VS Code ワークスペースプロファイル

各プロジェクトの `.vscode/settings.json` に固有のカラーテーマを設定し、並行開発時の誤操作を防止。

---

# ASCII図作成仕様

## 基本ルール

- **罫線**: `─│┌┐└┘├┤┬┴┼` を使用
- **ボックス内ラベル**: 英語のみ
- **日本語コメント**: 行末に `  # ○○` 形式
- **矢印**: `->`, `<-`, `v`, `^` のみ（Unicode矢印は禁止）
- **幅統一**: 図内の全行は同一幅に揃える

## 縦罫線ズレ防止

横幅の文字数を数えて、全行を同一幅に揃えることで縦の罫線ズレを抑制する。

### 幅検証コマンド
```bash
for i in $(seq START END); do
  line=$(sed -n "${i}p" "FILE.md")
  cleaned=$(echo "$line" | sed 's/  #.*//')
  width=$(echo -n "$cleaned" | perl -CS -lne 'print length')
  printf "Line %3d: width=%2d\n" "$i" "$width"
done
```

### 禁止文字
| 文字 | 問題 | 対策 |
|------|------|------|
| Unicode矢印 `→←↓↑` | 幅不定 | ASCII矢印を使用 |
| 全角スペース | 2文字幅 | 半角スペースのみ |
| ボックス内日本語 | 幅ズレ | 英語 + 行末コメント |

## テンプレート例

```
┌────────┐      ┌────────┐      ┌────────┐
│  Svc A │----->│  Svc B │----->│  Svc C │
└────────┘      └────────┘      └────────┘
# サービス間連携図
```

---

# ローカル開発サーバー運用ルール

## ポート割り当てポリシー

### 基本方針
- **ポート3000は避ける**（他プロジェクトとの競合防止）
- 各ワークスペースに固有のポートを割り当て
- 使用ポートはワークスペースのCLAUDE.mdに記録

### ポート割り当て手順

1. **初回起動時**
   - 空いているポート（3001以降）を検索
   - サーバーを起動
   - 使用ポートをワークスペースのCLAUDE.mdに記載

2. **2回目以降**
   - CLAUDE.mdに記載されたポートを優先使用
   - ポートが使用中の場合は次の空きポートを使用

---

## プレビュー機能の使用ルール

### トリガー
ユーザーが以下のように指示した場合：
- 「ローカル環境で公開」
- 「プレビューして」
- 「ブラウザで確認」

### 動作フロー

1. **ローカルサーバー起動**
   - ポート3000を避けて空きポートを検索
   - 開発サーバーを起動（バックグラウンド実行）

2. **VS Code内ブラウザで表示**
   - Live Preview拡張機能を使用
   - VS Code内のブラウザウィンドウで表示
   - 外部ブラウザは使用しない

3. **自動リロード**
   - ファイル編集時に自動的にプレビュー更新
   - Hot Module Replacement (HMR) 対応

### 使用ツール

| ツール | 用途 | 備考 |
|--------|------|------|
| Live Preview | 静的HTML/CSS | VS Code拡張機能 |
| `npm run dev` | Next.js/React | フレームワーク標準 |
| `python -m http.server` | 汎用静的サーバー | ポート指定可能 |

### プレビュー終了

- サーバープロセスはバックグラウンドで実行
- 明示的な停止指示がない限り起動状態を維持
- ポート確認: `lsof -i :PORT番号`
- 停止: `kill $(lsof -ti :PORT番号)`
