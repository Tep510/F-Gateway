# F-Gateway

| 項目 | 内容 |
|------|------|
| プロダクト名 | F-Gateway |
| 正式表記 | F｜ゲートウェイ |
| 読み方 | エフ・ゲートウェイ |
| ステータス | **設計完了** |
| 最終更新 | 2026-01-28 |
| 版数 | v0.7 |

---

## 概要

F-Gateway は、クライアントと Friendslogi 間のデータ交換ポータルです。**1日1CSV方式**で、出庫予定・入庫予定のCSVアップロード、出庫実績・入庫実績の返却、商品マスタの管理を行います。

### アプリの目的

| 目的 | 説明 |
|------|------|
| **データ交換の自動化** | 手動での CSV アップロード・ダウンロードの手間を削減 |
| **エラーの早期検出** | CSV フォーマット検証により、処理前にエラーを検知 |
| **業務の透明化** | クライアントが自社の作業履歴をリアルタイムで確認可能 |
| **商品マスタの最新化** | 商品マスタの更新頻度を可視化し、データ鮮度を維持 |

### クライアントへの提供価値

| 提供価値 | 具体的な効果 |
|---------|-------------|
| **作業履歴の可視化** | カレンダー形式で「いつ何をアップロードしたか」を即座に把握 |
| **エラーの即時通知** | CSV エラー時に Asana で即座に通知、問題の早期発見・迅速な対応 |
| **Google Drive 連携** | 使い慣れた Google Drive でファイル管理、学習コスト不要 |
| **商品マスタの鮮度管理** | 最終更新日を可視化し、更新を促進、データの陳腐化を防止 |

### 業務効率化のポイント

| 従来（手動） | F-Gateway 導入後 |
|------------|-----------------|
| WMS 取込時にエラー発覚 | アップロード直後に検証・即通知 |
| 手動でコピー・リネーム | 検証 OK 時に自動転送・自動リネーム |
| メール添付 or 手動アップロード | 自動で Google Drive に返却 |
| 個別にファイル確認 | カレンダー形式で一覧表示 |
| 更新漏れが発生しやすい | 更新遅延日数を表示し、定期更新を促進 |

### 業務モデル

- **出庫予定**: 1日1ファイルのCSVをアップロード
- **出庫実績**: 1日1ファイルのCSVを返却
- **入庫予定**: 1日1ファイルのCSVをアップロード
- **入庫実績**: 1日1ファイルのCSVを返却
- **商品マスタ**: 随時アップロード、可能な限り毎日更新を推奨
- **履歴表示**: カレンダー形式で日別の作業状況を表示
- **プロセス**: 処理中ステータスは表示せず、完了/エラーのみ表示

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         F-Gateway System Flow                               │
└─────────────────────────────────────────────────────────────────────────────┘

  [Client]                    [F-Gateway]                    [Friendslogi]

  ┌──────────┐               ┌──────────┐               ┌──────────┐
  │  Client  │   Upload      │          │   Transfer    │   WMS    │
  │  Google  │-------------->│ Validate │-------------->│  Portal  │
  │  Drive   │   CSV         │ & Route  │   CSV         │          │
  └──────────┘               └──────────┘               └──────────┘
       ^                          │                          │
       │                          │ Notify                   │
       │                          v                          │
       │                    ┌──────────┐                     │
       │                    │  Asana   │                     │
       │                    │ Project  │                     │
       │                    └──────────┘                     │
       │                                                     │
       └──────────────── Return Shipment Result ─────────────┘
```

---

## 背景・目的

### 現状の課題

- クライアントは毎日Google Driveに出荷依頼CSVを手動アップロード
- CSVフォーマットエラーが発生しても即座に検知できない
- 出荷実績の返却も手動で行っている
- クライアントごとに異なる設定（Google Drive場所等）の管理が煩雑

### F-Gateway による解決

1. **自動検証**: アップロード即座にフォーマット検証、エラー通知
2. **自動転送**: 検証OK時に社内Google Driveへ自動転送・リネーム
3. **自動返却**: 出荷実績CSVを自動でクライアントへ返却
4. **一元管理**: クライアント別設定を一箇所で管理
5. **柔軟なCSV対応**: 文字コード・改行コード自動検出、柔軟な項目マッピング

---

## 主要機能

### 認証・ユーザー管理

| 機能 | 説明 |
|------|------|
| **Google認証** | クライアントがGoogleアカウントでログイン |
| **クライアント管理** | クライアントID体系に基づくクライアント登録・管理 |
| **ユーザー管理** | Admin側でログインユーザーを管理（クライアントは設定不可） |

### クライアント設定管理

| 機能 | 説明 |
|------|------|
| **Google Drive設定** | クライアントごとに5種類のフォルダを設定 |
| ├ 出庫予定フォルダ | 出庫依頼CSVの提出先 |
| ├ 出庫実績フォルダ | 出庫実績CSVの返却先 |
| ├ 入庫予定フォルダ | 入庫予定CSVの提出先 |
| ├ 入庫実績フォルダ | 入庫実績CSVの返却先 |
| └ 商品マスタフォルダ | 商品マスタCSVの提出先 |
| **Asanaプロジェクト設定** | クライアントごとにAsanaプロジェクトURLを設定 |

### CSV受付・検証・マッピング（重要機能）

F-Gatewayは、クライアントが自由形式で提出するCSVを標準形式に自動変換します。

詳細は **[CSVマッピング設計書](./CSVマッピング設計書.md)** を参照してください。

| 機能 | 説明 |
|------|------|
| **日次CSV受付** | 1日1ファイルのCSV受付（出庫予定・入庫予定） |
| **文字コード自動検出** | UTF-8, Shift_JIS, EUC-JPを自動判定 |
| **改行コード自動検出** | CRLF, LF, CRを自動判定 |
| **柔軟な項目マッピング** | クライアント独自のCSV列名を標準形式に自動変換 |
| **フォーマット検証** | 必須項目、データ型、文字長の検証 |
| **自動転送** | 検証OK時に社内Google Driveへ自動転送 |
| **エラー通知** | 検証エラー時にAsanaへ自動通知 |

### 商品マスタ管理（最重要機能）

F-Gatewayの最重要機能の一つ。各クライアントの商品マスタを柔軟に管理します。

詳細は **[商品マスタ管理設計書](./商品マスタ管理設計書.md)** を参照してください。

| 機能 | 説明 |
|------|------|
| **柔軟な項目マッピング** | クライアントごとに異なるCSV列定義に対応 |
| **巨大CSV対応** | 数万件規模のCSVをストリーム処理で高速インポート（最大10万行） |
| **手動CSVアップロード** | Google Drive経由でCSVを手動アップロード |
| **URL自動取得** | 指定URLから毎日自動で商品マスタを取得 |
| **商品マスタ一覧表示** | クライアントが自社の商品マスタをテーブル形式で閲覧（ページネーション対応） |
| **検索・フィルタ機能** | 商品コード、商品名、JANコードでの検索 |
| **更新遅延表示** | 最終更新日からの経過日数を表示・色分け（緑・黄・赤） |
| **更新促進メッセージ** | 「可能な限り毎日更新してください」と表示 |
| **必須項目管理** | 社内標準の必須項目を定義し、厳密に管理 |
| **バリデーション** | 必須項目チェック、データ型検証 |
| **インポート履歴** | 過去のインポート履歴・エラーログを表示 |

### 作業履歴・ダッシュボード

| 機能 | 説明 |
|------|------|
| **日次作業履歴** | カレンダー形式で日別の作業状況を表示 |
| **出庫実績返却** | 出庫完了後のCSVをクライアントへ返却（1日1件） |
| **入庫実績返却** | 入庫完了後のCSVをクライアントへ返却（1日1件） |
| **Asana連携** | エラー/完了通知をAsanaプロジェクトへ |

---

## ユーザーロール

| ロール | 説明 | アクセス範囲 |
|--------|------|-------------|
| **Admin** | Friendslogi管理者 | 全機能・全クライアント |
| **Client** | クライアント担当者 | 自社データのみ |

- クライアントユーザーはログイン後、自動的に自社ダッシュボードへ遷移
- ユーザー登録はAdmin側でのみ実施（クライアントは自分でユーザー追加不可）

---

## 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | Next.js 16 + TypeScript |
| スタイリング | Tailwind CSS 3.4.17 |
| ホスティング | Vercel |
| データベース | **Neon (PostgreSQL)** |
| 認証 | Google OAuth 2.0 |
| 外部連携 | Google Drive API, Asana API |
| 開発ポート | 3002 |

> **Note**:
> - Neon採用理由 - 少量データ（設定・ログ）、イベント駆動アクセス、サーバーレス向き
> - Tailwind CSS v4互換性問題のため3.4.17を使用

---

## モックアップ

### 実装状況

✅ **モックアップ完成** (2026-01-28)

| 項目 | 状態 |
|------|------|
| プロジェクト初期化 | ✅ 完了 |
| トップページ | ✅ 完了 |
| Client Dashboard | ✅ 完了 |
| Admin Dashboard | ✅ 完了 |
| 日次履歴カレンダーUI | ✅ 完了 |
| 業務アプリ配色 | ✅ 完了 |

### ディレクトリ構成

```
F-Gateway/
├── README.md           # 本ファイル
├── 設計書.md           # 詳細設計書
└── web/               # モックアップ実装
    ├── app/
    │   ├── page.tsx                # トップ（ログイン選択）
    │   ├── client/page.tsx         # Client Dashboard
    │   ├── admin/page.tsx          # Admin Dashboard
    │   └── components/
    │       ├── Header.tsx          # ヘッダーコンポーネント
    │       └── Sidebar.tsx         # サイドバーコンポーネント
    ├── package.json
    └── tailwind.config.ts
```

### ローカル起動

```bash
cd web
npm install
npm run dev
```

アクセス: http://localhost:3002

### デザインコンセプト

F-Gatewayは、**現代風でモダンなUIでありながら、落ち着いて信頼感のある業務アプリデザイン**を採用しています。

| 項目 | 方針 |
|------|------|
| **色使い** | 落ち着いた配色、信頼感のある色調（青・緑・グレー） |
| **タイポグラフィ** | 読みやすさ重視、日本語フォント最適化（Noto Sans JP） |
| **レイアウト** | シンプルで見通しが良い構成、カード型レイアウト |
| **アイコン** | シンプルでわかりやすいアイコン、各メニューに付与 |
| **インタラクション** | スムーズで直感的、ホバーエフェクト |
| **日本語UI** | 全メニュー・ラベルを日本語化 |
| **カレンダー形式** | 日別の作業履歴をテーブル表示 |
| **プロセス非表示** | 処理中ステータスは表示せず、完了/エラーのみ |

---

## ドキュメント構成

| ファイル | 内容 |
|----------|------|
| [README.md](./README.md) | 本ドキュメント（概要） |
| [設計書.md](./設計書.md) | 詳細設計書 |
| **[UIデザイン設計書.md](./UIデザイン設計書.md)** | Vercel風の現代的なUIデザイン設計 |
| **[CSVマッピング設計書.md](./CSVマッピング設計書.md)** | CSV自動変換・柔軟マッピングの詳細設計 |
| **[商品マスタ管理設計書.md](./商品マスタ管理設計書.md)** | 商品マスタ管理の詳細設計 |
| **[技術補足設計書.md](./技術補足設計書.md)** | API設計、テスト、デプロイ、運用の詳細設計 |

---

## 関連ドキュメント

- [クライアントID体系](../../IDSystem/02_クライアントID.md) - クライアントコード仕様
- [F-WMSPortal](../F-WMSPortal/設計書.md) - WMSポータル（連携先）
- [Asana API仕様](../../ExternalSystems/Asana/README.md) - 通知連携
- [Google API仕様](../../ExternalSystems/Google/README.md) - Drive連携
- [アーキテクチャ設計書](../../System/アーキテクチャ設計書.md) - システム全体構成

---

## 担当者

| 役割 | 担当者 | 備考 |
|------|--------|------|
| 設計 | 後藤 | - |
| 開発エンジニア | Komaki | 技術選定・実装の最終確認 |

---

## 更新履歴

| 日付 | 版数 | 更新内容 | 更新者 |
|------|------|---------|--------|
| 2026-01-28 | 0.7 | CSVマッピング設計書を新規作成。文字コード・改行コード自動検出、柔軟な項目マッピング、視覚的マッピングUI設計を策定 | Teppei & Claude |
| 2026-01-28 | 0.6 | UIデザイン設計書を新規作成。Vercel/Supabase風の現代的なUI設計を策定。固定サイドバー廃止、横並びナビゲーション、ブレッドクラム構造、Scope Selector、Command Menu等を導入 | Teppei & Claude |
| 2026-01-28 | 0.5 | 商品マスタ管理を最重要機能として拡充。巨大CSV対応、柔軟な項目マッピング、URL自動取得機能を追加。別途「商品マスタ管理設計書」を作成 | Teppei & Claude |
| 2026-01-28 | 0.4 | アプリの目的・提供価値を明確化、Google Drive設定を5種類に拡張、商品マスタ管理機能追加、デザインコンセプト追加、全UIを日本語化 | Teppei & Claude |
| 2026-01-28 | 0.3 | モックアップ実装完成。1日1CSV方式、カレンダー形式UI、業務アプリデザイン適用 | Teppei & Claude |
| 2026-01-26 | 0.2 | 機能追加（クライアント管理、複数Google Drive、Admin/Client分離、Asana通知設定）、DB変更（Neon） | Claude |
| 2026-01-26 | 0.1 | 初版作成（設計中） | Claude |
