# F-Gateway æŠ€è¡“è£œè¶³è¨­è¨ˆæ›¸

| é …ç›® | å†…å®¹ |
|------|------|
| æ–‡æ›¸ç•ªå· | DEV-GATEWAY-TECH-001 |
| ç‰ˆæ•° | 1.0 |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è¨­è¨ˆå®Œäº† |
| æœ€çµ‚æ›´æ–° | 2026-01-28 |

---

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€F-Gatewayã®ä¸»è¦è¨­è¨ˆæ›¸ã‚’è£œå®Œã™ã‚‹æŠ€è¡“è©³ç´°ã‚’è¨˜è¿°ã—ã¾ã™ã€‚APIè¨­è¨ˆã€ç’°å¢ƒå¤‰æ•°ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã€ç›£è¦–ãƒ»é‹ç”¨ã«é–¢ã™ã‚‹è©³ç´°ã‚’å®šç¾©ã—ã¾ã™ã€‚

---

## 1. APIè¨­è¨ˆ

### 1.1 Next.js API Routesæ§‹æˆ

```
app/api/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ [...nextauth]/
â”‚   â”‚   â””â”€â”€ route.ts              # NextAuth.jsèªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ callback/
â”‚       â””â”€â”€ route.ts               # Google OAuth callback
â”‚
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ clients/
â”‚   â”‚   â”œâ”€â”€ route.ts               # GET: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§, POST: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
â”‚   â”‚   â””â”€â”€ [clientId]/
â”‚   â”‚       â”œâ”€â”€ route.ts           # GET, PATCH, DELETE
â”‚   â”‚       â”œâ”€â”€ users/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts       # GET: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§, POST: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
â”‚   â”‚       â””â”€â”€ settings/
â”‚   â”‚           â””â”€â”€ route.ts       # GET, PATCH: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š
â”‚   â””â”€â”€ logs/
â”‚       â””â”€â”€ route.ts               # GET: ãƒ­ã‚°ä¸€è¦§ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
â”‚
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ route.ts               # GET: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ shipping/
â”‚   â”‚   â””â”€â”€ route.ts               # GET: å‡ºåº«å±¥æ­´
â”‚   â”œâ”€â”€ receiving/
â”‚   â”‚   â””â”€â”€ route.ts               # GET: å…¥åº«å±¥æ­´
â”‚   â””â”€â”€ items/
â”‚       â”œâ”€â”€ route.ts               # GET: å•†å“ãƒã‚¹ã‚¿ä¸€è¦§, POST: CSV upload
â”‚       â”œâ”€â”€ [itemId]/
â”‚       â”‚   â””â”€â”€ route.ts           # GET, PATCH, DELETE
â”‚       â””â”€â”€ import/
â”‚           â””â”€â”€ route.ts           # POST: å•†å“ãƒã‚¹ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
â”‚
â”œâ”€â”€ webhook/
â”‚   â”œâ”€â”€ google-drive/
â”‚   â”‚   â””â”€â”€ route.ts               # POST: Google Drive Webhook
â”‚   â””â”€â”€ asana/
â”‚       â””â”€â”€ route.ts               # POST: Asana Webhookï¼ˆå°†æ¥ï¼‰
â”‚
â””â”€â”€ health/
    â””â”€â”€ route.ts                   # GET: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
```

### 1.2 APIä»•æ§˜

#### 1.2.1 èªè¨¼API

**POST /api/auth/signin**
- èª¬æ˜: Google OAuthèªè¨¼é–‹å§‹
- èªè¨¼: ä¸è¦
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: Googleèªè¨¼ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**GET /api/auth/callback**
- èª¬æ˜: Google OAuth callback
- èªè¨¼: ä¸è¦
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆå¾Œã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

#### 1.2.2 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç†API

**GET /api/admin/clients**
- èª¬æ˜: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§å–å¾—
- èªè¨¼: å¿…é ˆï¼ˆAdminï¼‰
- Query Parameters:
  - `page`: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ï¼‰
  - `limit`: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "clients": [
    {
      "id": 1,
      "clientCode": "DAQ",
      "clientName": "T-shirts.sc",
      "status": "active",
      "shippingPlanDriveId": "1abc123...",
      "shippingResultDriveId": "1def456...",
      "receivingPlanDriveId": "1ghi789...",
      "receivingResultDriveId": "1jkl012...",
      "asanaEnabled": false,
      "monthlyExecutionDay": null,
      "createdAt": "2026-01-20T10:00:00Z",
      "updatedAt": "2026-01-28T10:00:00Z",
      "_count": { "users": 2, "csvUploadLogs": 15 }
    }
  ]
}
```

**POST /api/admin/clients**
- èª¬æ˜: æ–°è¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
- èªè¨¼: å¿…é ˆï¼ˆAdminï¼‰
- Request Body:
```json
{
  "clientCode": "DAQ",
  "clientName": "T-shirts.sc",
  "shippingPlanDriveId": "1abc123...",
  "shippingResultDriveId": "1def456...",
  "receivingPlanDriveId": "1ghi789...",
  "receivingResultDriveId": "1jkl012...",
  "asanaProjectId": "1234567890"
}
```
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ä½œæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±

**Google Driveãƒ•ã‚©ãƒ«ãƒ€è¨­å®šï¼ˆ4ç¨®é¡ï¼‰**

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | èª¬æ˜ | ç”¨é€” |
|----------|------|------|
| `shippingPlanDriveId` | å‡ºåº«äºˆå®šãƒ•ã‚©ãƒ«ãƒ€ID | å‡ºåº«äºˆå®šCSVã®ä¿å­˜å…ˆ |
| `shippingResultDriveId` | å‡ºåº«å®Ÿç¸¾ãƒ•ã‚©ãƒ«ãƒ€ID | å‡ºåº«å®Ÿç¸¾CSVã®ä¿å­˜å…ˆ |
| `receivingPlanDriveId` | å…¥åº«äºˆå®šãƒ•ã‚©ãƒ«ãƒ€ID | å…¥åº«äºˆå®šCSVã®ä¿å­˜å…ˆ |
| `receivingResultDriveId` | å…¥åº«å®Ÿç¸¾ãƒ•ã‚©ãƒ«ãƒ€ID | å…¥åº«å®Ÿç¸¾CSVã®ä¿å­˜å…ˆ |

**GET /api/admin/clients/[clientId]**
- èª¬æ˜: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©³ç´°å–å¾—
- èªè¨¼: å¿…é ˆï¼ˆAdminï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©³ç´°æƒ…å ±

**PATCH /api/admin/clients/[clientId]**
- èª¬æ˜: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±æ›´æ–°
- èªè¨¼: å¿…é ˆï¼ˆAdminï¼‰
- Request Body: æ›´æ–°å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿

**DELETE /api/admin/clients/[clientId]**
- èª¬æ˜: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå‰Šé™¤
- èªè¨¼: å¿…é ˆï¼ˆAdminï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 204 No Content

#### 1.2.3 å•†å“ãƒã‚¹ã‚¿API

**GET /api/client/items**
- èª¬æ˜: å•†å“ãƒã‚¹ã‚¿ä¸€è¦§å–å¾—
- èªè¨¼: å¿…é ˆï¼ˆClientï¼‰
- Query Parameters:
  - `page`: ãƒšãƒ¼ã‚¸ç•ªå·
  - `limit`: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
  - `search`: æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆå•†å“ã‚³ãƒ¼ãƒ‰ã€å•†å“åã€JANã‚³ãƒ¼ãƒ‰ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: å•†å“ãƒã‚¹ã‚¿ä¸€è¦§

**POST /api/client/items/import**
- èª¬æ˜: å•†å“ãƒã‚¹ã‚¿CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- èªè¨¼: å¿…é ˆï¼ˆClientï¼‰
- Content-Type: multipart/form-data
- Request Body:
  - `file`: CSVãƒ•ã‚¡ã‚¤ãƒ«
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "success": true,
  "imported_count": 1234,
  "errors": []
}
```

#### 1.2.4 ãƒ­ã‚°API

**GET /api/admin/logs**
- èª¬æ˜: ãƒ­ã‚°ä¸€è¦§å–å¾—
- èªè¨¼: å¿…é ˆï¼ˆAdminï¼‰
- Query Parameters:
  - `page`: ãƒšãƒ¼ã‚¸ç•ªå·
  - `limit`: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
  - `client_id`: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã§ãƒ•ã‚£ãƒ«ã‚¿
  - `type`: ãƒ­ã‚°ã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆupload, validation, transfer, notificationï¼‰
  - `status`: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆsuccess, errorï¼‰
  - `date_from`: é–‹å§‹æ—¥
  - `date_to`: çµ‚äº†æ—¥
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ãƒ­ã‚°ä¸€è¦§

#### 1.2.5 Webhook API

**POST /api/webhook/google-drive**
- èª¬æ˜: Google Driveå¤‰æ›´é€šçŸ¥
- èªè¨¼: Google Drive Webhookç½²åæ¤œè¨¼
- Request Body: Google Driveé€šçŸ¥ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK

### 1.3 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

å…¨APIã§çµ±ä¸€ã—ãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’ä½¿ç”¨ï¼š

```json
{
  "error": {
    "code": "CLIENT_NOT_FOUND",
    "message": "æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
    "details": {
      "client_id": "550e8400-e29b-41d4-a716-446655440000"
    }
  }
}
```

---

## 2. ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³»

### 2.1 ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šç¾©

| ã‚³ãƒ¼ãƒ‰ | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ | å¯¾å‡¦æ–¹æ³• |
|--------|--------------|------|---------|
| **èªè¨¼ãƒ»èªå¯** |
| `AUTH_REQUIRED` | 401 | èªè¨¼ãŒå¿…è¦ã§ã™ | ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ |
| `AUTH_INVALID` | 401 | èªè¨¼æƒ…å ±ãŒç„¡åŠ¹ã§ã™ | å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ |
| `AUTH_EXPIRED` | 401 | ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœŸé™åˆ‡ã‚Œã§ã™ | å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ |
| `PERMISSION_DENIED` | 403 | æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ | Adminæ¨©é™ãŒå¿…è¦ã§ã™ |
| `CLIENT_ACCESS_DENIED` | 403 | ä»–ç¤¾ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ | è‡ªç¤¾ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ |
| **ãƒªã‚½ãƒ¼ã‚¹** |
| `CLIENT_NOT_FOUND` | 404 | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ç¢ºèªã—ã¦ãã ã•ã„ |
| `USER_NOT_FOUND` | 404 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç¢ºèªã—ã¦ãã ã•ã„ |
| `ITEM_NOT_FOUND` | 404 | å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ | å•†å“IDã‚’ç¢ºèªã—ã¦ãã ã•ã„ |
| `LOG_NOT_FOUND` | 404 | ãƒ­ã‚°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ | ãƒ­ã‚°IDã‚’ç¢ºèªã—ã¦ãã ã•ã„ |
| **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** |
| `VALIDATION_ERROR` | 400 | å…¥åŠ›å€¤ãŒä¸æ­£ã§ã™ | ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ |
| `INVALID_CLIENT_CODE` | 400 | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ãŒä¸æ­£ã§ã™ | 3æ–‡å­—ã®è‹±å¤§æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ |
| `INVALID_CSV_FORMAT` | 400 | CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒä¸æ­£ã§ã™ | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ |
| `CSV_TOO_LARGE` | 400 | CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã™ãã¾ã™ | 100MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ |
| `CSV_COLUMN_MISMATCH` | 400 | CSVåˆ—æ•°ãŒä¸€è‡´ã—ã¾ã›ã‚“ | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ |
| **å‡¦ç†ã‚¨ãƒ©ãƒ¼** |
| `IMPORT_FAILED` | 500 | ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ | å¾Œã§å†è©¦è¡Œã—ã¦ãã ã•ã„ |
| `GOOGLE_DRIVE_ERROR` | 500 | Google Driveé€£æºã‚¨ãƒ©ãƒ¼ | ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ |
| `ASANA_ERROR` | 500 | Asanaé€£æºã‚¨ãƒ©ãƒ¼ | ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ |
| `DATABASE_ERROR` | 500 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ | ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ |
| **ãƒ¬ãƒ¼ãƒˆåˆ¶é™** |
| `RATE_LIMIT_EXCEEDED` | 429 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒåˆ¶é™ã‚’è¶…ãˆã¾ã—ãŸ | ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ |

### 2.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```
[Error Occurrence]
      â”‚
      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Error Detection                  â”‚  # ã‚¨ãƒ©ãƒ¼æ¤œå‡º
â”‚    - API Level                      â”‚
â”‚    - Service Level                  â”‚
â”‚    - Database Level                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Error Classification             â”‚  # ã‚¨ãƒ©ãƒ¼åˆ†é¡
â”‚    - Client Error (4xx)             â”‚
â”‚    - Server Error (5xx)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Error Logging                    â”‚  # ãƒ­ã‚°è¨˜éŒ²
â”‚    - Database (M_Log)               â”‚
â”‚    - Console (development)          â”‚
â”‚    - Monitoring Service (Sentry)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Error Response                   â”‚  # ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
â”‚    - Structured JSON                â”‚
â”‚    - Error Code                     â”‚
â”‚    - User-friendly Message          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Notification (if critical)       â”‚  # é€šçŸ¥ï¼ˆé‡å¤§ã‚¨ãƒ©ãƒ¼ã®ã¿ï¼‰
â”‚    - Asana Task Creation            â”‚
â”‚    - Admin Email (optional)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç’°å¢ƒå¤‰æ•°è¨­è¨ˆ

### 3.1 å¿…é ˆç’°å¢ƒå¤‰æ•°

**.env.local** (ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ»æœ¬ç•ªå…±é€š)

```bash
# ===============================
# Database (Neon PostgreSQL)
# ===============================
DATABASE_URL="postgresql://user:password@host/database?sslmode=require"

# ===============================
# Authentication (NextAuth.js)
# ===============================
NEXTAUTH_URL="http://localhost:3002"
NEXTAUTH_SECRET="your-secret-key-here"  # openssl rand -base64 32

# Google OAuth
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# ===============================
# Google Drive API
# ===============================
GOOGLE_DRIVE_API_KEY="your-google-api-key"
GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON='{"type":"service_account",...}'

# ===============================
# Asana API
# ===============================
ASANA_PERSONAL_ACCESS_TOKEN="your-asana-token"

# ===============================
# Application Settings
# ===============================
NODE_ENV="development"  # development | production
PORT="3002"

# ===============================
# Monitoring (Optional)
# ===============================
SENTRY_DSN="your-sentry-dsn"  # ã‚¨ãƒ©ãƒ¼ç›£è¦–
VERCEL_ANALYTICS_ID="your-vercel-analytics-id"  # ã‚¢ã‚¯ã‚»ã‚¹è§£æ

# ===============================
# Feature Flags (Optional)
# ===============================
ENABLE_ITEM_MASTER_AUTO_FETCH="true"  # å•†å“ãƒã‚¹ã‚¿è‡ªå‹•å–å¾—
ENABLE_ASANA_NOTIFICATIONS="true"     # Asanaé€šçŸ¥
```

### 3.2 ç’°å¢ƒå¤‰æ•°ã®å–å¾—ãƒ»æ¤œè¨¼

**lib/env.ts**
```typescript
// ç’°å¢ƒå¤‰æ•°ã®å‹å®‰å…¨ãªå–å¾—
export const env = {
  database: {
    url: process.env.DATABASE_URL!,
  },
  auth: {
    url: process.env.NEXTAUTH_URL!,
    secret: process.env.NEXTAUTH_SECRET!,
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    },
  },
  googleDrive: {
    apiKey: process.env.GOOGLE_DRIVE_API_KEY!,
    serviceAccount: JSON.parse(process.env.GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON!),
  },
  asana: {
    token: process.env.ASANA_PERSONAL_ACCESS_TOKEN!,
  },
  app: {
    nodeEnv: process.env.NODE_ENV || 'development',
    port: parseInt(process.env.PORT || '3002', 10),
  },
};

// èµ·å‹•æ™‚ã«ç’°å¢ƒå¤‰æ•°ã®å­˜åœ¨ã‚’æ¤œè¨¼
export function validateEnv() {
  const required = [
    'DATABASE_URL',
    'NEXTAUTH_URL',
    'NEXTAUTH_SECRET',
    'GOOGLE_CLIENT_ID',
    'GOOGLE_CLIENT_SECRET',
    'GOOGLE_DRIVE_API_KEY',
    'GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON',
    'ASANA_PERSONAL_ACCESS_TOKEN',
  ];

  const missing = required.filter(key => !process.env[key]);

  if (missing.length > 0) {
    throw new Error(`Missing required environment variables: ${missing.join(', ')}`);
  }
}
```

---

## 4. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### 4.1 ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

| ãƒ†ã‚¹ãƒˆãƒ¬ãƒ™ãƒ« | ãƒ„ãƒ¼ãƒ« | ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ | å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|------------|--------|--------------|--------------|
| **å˜ä½“ãƒ†ã‚¹ãƒˆ** | Jest + React Testing Library | 80%ä»¥ä¸Š | ã‚³ãƒŸãƒƒãƒˆæ™‚ |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** | Jest + Supertest | 70%ä»¥ä¸Š | PRä½œæˆæ™‚ |
| **E2Eãƒ†ã‚¹ãƒˆ** | Playwright | ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®ã¿ | ãƒ‡ãƒ—ãƒ­ã‚¤å‰ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ** | Lighthouse CI | -  | PRä½œæˆæ™‚ |

### 4.2 ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
web/
â”œâ”€â”€ __tests__/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ModernHeader.test.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ csv-validator.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ clients.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ items.test.ts
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ google-drive.test.ts
â”‚   â””â”€â”€ e2e/
â”‚       â”œâ”€â”€ client-dashboard.spec.ts
â”‚       â”œâ”€â”€ admin-dashboard.spec.ts
â”‚       â””â”€â”€ item-master-import.spec.ts
â”œâ”€â”€ jest.config.js
â””â”€â”€ playwright.config.ts
```

### 4.3 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹

#### 4.3.1 å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆCSVæ¤œè¨¼ï¼‰

```typescript
// __tests__/unit/lib/csv-validator.test.ts
import { validateCSV } from '@/lib/csv-validator';

describe('CSV Validator', () => {
  describe('validateCSV', () => {
    it('æ­£å¸¸ãªCSVã‚’ãƒ‘ã‚¹ã™ã‚‹', () => {
      const csv = 'col1,col2,col3\nval1,val2,val3';
      const result = validateCSV(csv, { expectedColumns: 3 });
      expect(result.valid).toBe(true);
      expect(result.errors).toHaveLength(0);
    });

    it('åˆ—æ•°ä¸ä¸€è‡´ã§ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™', () => {
      const csv = 'col1,col2,col3\nval1,val2';
      const result = validateCSV(csv, { expectedColumns: 3 });
      expect(result.valid).toBe(false);
      expect(result.errors).toContain('åˆ—æ•°ãŒä¸æ­£ã§ã™');
    });
  });
});
```

#### 4.3.2 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆAPIï¼‰

```typescript
// __tests__/integration/api/clients.test.ts
import { testApiHandler } from 'next-test-api-route-handler';
import * as clientsHandler from '@/app/api/admin/clients/route';

describe('/api/admin/clients', () => {
  it('Adminæ¨©é™ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—ã§ãã‚‹', async () => {
    await testApiHandler({
      handler: clientsHandler,
      test: async ({ fetch }) => {
        const res = await fetch({
          method: 'GET',
          headers: {
            cookie: 'next-auth.session-token=valid-admin-token',
          },
        });
        expect(res.status).toBe(200);
        const data = await res.json();
        expect(data.clients).toBeInstanceOf(Array);
      },
    });
  });

  it('Clientæ¨©é™ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ã•ã‚Œã‚‹', async () => {
    await testApiHandler({
      handler: clientsHandler,
      test: async ({ fetch }) => {
        const res = await fetch({
          method: 'GET',
          headers: {
            cookie: 'next-auth.session-token=valid-client-token',
          },
        });
        expect(res.status).toBe(403);
      },
    });
  });
});
```

#### 4.3.3 E2Eãƒ†ã‚¹ãƒˆï¼ˆå•†å“ãƒã‚¹ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰

```typescript
// __tests__/e2e/item-master-import.spec.ts
import { test, expect } from '@playwright/test';

test('å•†å“ãƒã‚¹ã‚¿CSVã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹', async ({ page }) => {
  // ãƒ­ã‚°ã‚¤ãƒ³
  await page.goto('/');
  await page.click('text=ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ­ã‚°ã‚¤ãƒ³');
  // Googleèªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’ãƒ¢ãƒƒã‚¯...

  // å•†å“ãƒã‚¹ã‚¿ãƒšãƒ¼ã‚¸ã¸é·ç§»
  await page.click('text=å•†å“ãƒã‚¹ã‚¿');
  await expect(page).toHaveURL('/client/items');

  // CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const fileInput = page.locator('input[type="file"]');
  await fileInput.setInputFiles('fixtures/item_master_valid.csv');

  // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
  await page.click('text=CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰');

  // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
  await expect(page.locator('text=1234ä»¶ã®å•†å“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ')).toBeVisible();
});
```

### 4.4 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆ
npm run test:unit

# çµ±åˆãƒ†ã‚¹ãƒˆ
npm run test:integration

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e

# å…¨ãƒ†ã‚¹ãƒˆ
npm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬
npm run test:coverage
```

---

## 5. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆ

### 5.1 ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ§‹æˆ

| ç’°å¢ƒ | ã‚µãƒ¼ãƒ“ã‚¹ | URL | ç”¨é€” |
|------|---------|-----|------|
| **æœ¬ç•ª** | Vercel Production | https://f-gateway.vercel.app | æœ¬ç•ªç’°å¢ƒ |
| **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°** | Vercel Preview | https://f-gateway-staging.vercel.app | æ¤œè¨¼ç’°å¢ƒ |
| **é–‹ç™º** | Localhost | http://localhost:3002 | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º |

### 5.2 Vercelãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

**vercel.json**
```json
{
  "version": 2,
  "buildCommand": "cd web && npm run build",
  "devCommand": "cd web && npm run dev",
  "installCommand": "cd web && npm install",
  "framework": "nextjs",
  "regions": ["nrt1"],
  "env": {
    "NODE_ENV": "production"
  },
  "build": {
    "env": {
      "DATABASE_URL": "@database_url",
      "NEXTAUTH_URL": "@nextauth_url",
      "NEXTAUTH_SECRET": "@nextauth_secret",
      "GOOGLE_CLIENT_ID": "@google_client_id",
      "GOOGLE_CLIENT_SECRET": "@google_client_secret",
      "GOOGLE_DRIVE_API_KEY": "@google_drive_api_key",
      "GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON": "@google_drive_service_account_json",
      "ASANA_PERSONAL_ACCESS_TOKEN": "@asana_personal_access_token"
    }
  }
}
```

### 5.3 CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### GitHub Actionsè¨­å®š

**.github/workflows/ci.yml**
```yaml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: cd web && npm ci

      - name: Run linter
        run: cd web && npm run lint

      - name: Run tests
        run: cd web && npm test

      - name: Build
        run: cd web && npm run build

      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

**.github/workflows/deploy.yml**
```yaml
name: Deploy to Vercel

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
```

### 5.4 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

```
[Developer]
     â”‚
     â”‚ git push
     v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Repository                   â”‚
â”‚ (main / develop)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Trigger
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions                      â”‚
â”‚  1. Lint Check                      â”‚
â”‚  2. Run Tests                       â”‚
â”‚  3. Build                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Success
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel Deploy                       â”‚
â”‚  - Build Next.js App                â”‚
â”‚  - Deploy to Edge Network           â”‚
â”‚  - Run Health Check                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Complete
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production / Preview                â”‚
â”‚ https://f-gateway.vercel.app        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ç›£è¦–ãƒ»é‹ç”¨è¨­è¨ˆ

### 6.1 ãƒ­ã‚°ç®¡ç†

#### 6.1.1 ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«

| ãƒ¬ãƒ™ãƒ« | ç”¨é€” | ä¿å­˜å…ˆ |
|--------|------|--------|
| **ERROR** | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ | Database + Sentry |
| **WARN** | è­¦å‘Šäº‹é … | Database |
| **INFO** | é€šå¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ | Database |
| **DEBUG** | ãƒ‡ãƒãƒƒã‚°æƒ…å ± | Console (é–‹ç™ºç’°å¢ƒã®ã¿) |

#### 6.1.2 ãƒ­ã‚°å‡ºåŠ›å½¢å¼

```typescript
// lib/logger.ts
export interface LogEntry {
  level: 'ERROR' | 'WARN' | 'INFO' | 'DEBUG';
  timestamp: string;
  message: string;
  context: {
    client_id?: string;
    user_id?: string;
    file_name?: string;
    api_endpoint?: string;
  };
  error?: {
    code: string;
    stack?: string;
  };
}

// ä½¿ç”¨ä¾‹
logger.error('CSV validation failed', {
  context: {
    client_id: 'DAQ',
    file_name: 'shipping_20260128.csv',
  },
  error: {
    code: 'CSV_COLUMN_MISMATCH',
    stack: error.stack,
  },
});
```

### 6.2 ç›£è¦–è¨­è¨ˆ

#### 6.2.1 ç›£è¦–é …ç›®

| é …ç›® | ç›£è¦–å†…å®¹ | ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤ | é€šçŸ¥å…ˆ |
|------|---------|-------------|--------|
| **ç¨¼åƒç‡** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯ç”¨æ€§ | < 99.0% | Admin Email |
| **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ** | APIå¿œç­”æ™‚é–“ | > 3ç§’ | Slack |
| **ã‚¨ãƒ©ãƒ¼ç‡** | 5xxã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç‡ | > 1% | Slack + Admin Email |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š** | Neonæ¥ç¶šãƒ—ãƒ¼ãƒ«çŠ¶æ³ | æ®‹ã‚Šæ¥ç¶šæ•° < 10 | Slack |
| **CSVå‡¦ç†** | å‡¦ç†æˆåŠŸç‡ | < 95% | Asana |
| **Google Drive API** | APIã‚¨ãƒ©ãƒ¼ç‡ | > 5% | Slack |
| **Asana API** | APIã‚¨ãƒ©ãƒ¼ç‡ | > 5% | Slack |

#### 6.2.2 ç›£è¦–ãƒ„ãƒ¼ãƒ«

| ãƒ„ãƒ¼ãƒ« | ç”¨é€” | è¨­å®š |
|--------|------|------|
| **Vercel Analytics** | ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | æ¨™æº–æ­è¼‰ |
| **Vercel Speed Insights** | Core Web Vitalsç›£è¦– | æ¨™æº–æ­è¼‰ |
| **Sentry** | ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° | Vercelé€£æº |
| **Neon Monitoring** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›£è¦– | Neon Dashboard |
| **Uptime Robot** | æ­»æ´»ç›£è¦– | å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ |

### 6.3 ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

#### 6.3.1 Sentryã‚¢ãƒ©ãƒ¼ãƒˆ

**sentry.client.config.ts**
```typescript
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
  beforeSend(event, hint) {
    // PIIï¼ˆå€‹äººæƒ…å ±ï¼‰ã‚’é™¤å¤–
    if (event.request) {
      delete event.request.cookies;
      delete event.request.headers;
    }
    return event;
  },
});
```

#### 6.3.2 ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ

```typescript
// lib/alert.ts
export async function sendCriticalAlert(message: string, details: object) {
  // 1. Slackã«é€šçŸ¥
  await fetch(process.env.SLACK_WEBHOOK_URL!, {
    method: 'POST',
    body: JSON.stringify({
      text: `ğŸš¨ Critical Alert: ${message}`,
      blocks: [
        {
          type: 'section',
          text: {
            type: 'mrkdwn',
            text: `*${message}*\n\`\`\`${JSON.stringify(details, null, 2)}\`\`\``,
          },
        },
      ],
    }),
  });

  // 2. Sentryã«è¨˜éŒ²
  Sentry.captureMessage(message, {
    level: 'error',
    extra: details,
  });
}
```

### 6.4 é‹ç”¨æ‰‹é †æ›¸

#### 6.4.1 æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯é …ç›®

| é …ç›® | ç¢ºèªå†…å®¹ | é »åº¦ |
|------|---------|------|
| **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°** | Sentryã§ã‚¨ãƒ©ãƒ¼ä»¶æ•°ç¢ºèª | æ¯æ—¥åˆå‰ |
| **CSVå‡¦ç†çŠ¶æ³** | å‰æ—¥ã®å‡¦ç†æˆåŠŸç‡ç¢ºèª | æ¯æ—¥åˆå‰ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®¹é‡** | Neon Dashboardã§å®¹é‡ç¢ºèª | æ¯æ—¥åˆå‰ |
| **APIä½¿ç”¨é‡** | Google Drive/Asana APIã‚¯ã‚©ãƒ¼ã‚¿ç¢ºèª | æ¯æ—¥åˆå‰ |

#### 6.4.2 éšœå®³å¯¾å¿œãƒ•ãƒ­ãƒ¼

```
[Alert Received]
      â”‚
      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Incident Identification          â”‚  # éšœå®³ç‰¹å®š
â”‚    - Check Sentry                   â”‚
â”‚    - Check Vercel Logs              â”‚
â”‚    - Check Neon Dashboard           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Impact Assessment                â”‚  # å½±éŸ¿ç¯„å›²ç¢ºèª
â”‚    - Affected Clients               â”‚
â”‚    - Affected Features              â”‚
â”‚    - Data Loss Risk                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Immediate Action                 â”‚  # å³æ™‚å¯¾å¿œ
â”‚    - Rollback (if needed)           â”‚
â”‚    - Disable Feature Flag           â”‚
â”‚    - Manual Processing              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Root Cause Analysis              â”‚  # åŸå› åˆ†æ
â”‚    - Review Logs                    â”‚
â”‚    - Reproduce Issue                â”‚
â”‚    - Identify Bug                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Fix & Deploy                     â”‚  # ä¿®æ­£ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚    - Code Fix                       â”‚
â”‚    - Test                           â”‚
â”‚    - Deploy                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Post-Mortem                      â”‚  # äº‹å¾Œãƒ¬ãƒ“ãƒ¥ãƒ¼
â”‚    - Document Incident              â”‚
â”‚    - Update Runbook                 â”‚
â”‚    - Prevent Recurrence             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚«ãƒãƒªè¨­è¨ˆ

### 7.1 ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ–¹æ³• | é »åº¦ | ä¿æŒæœŸé–“ |
|----------|---------------|------|---------|
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | Neonè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | æ¯æ—¥ | 7æ—¥é–“ |
| **Google Drive** | Googleæ¨™æº–ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  | ç„¡åˆ¶é™ |
| **ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  | 90æ—¥é–“ |

### 7.2 ç½å®³å¾©æ—§è¨ˆç”»ï¼ˆDRPï¼‰

#### 7.2.1 å¾©æ—§ç›®æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | èª¬æ˜ |
|------|--------|------|
| **RTOï¼ˆç›®æ¨™å¾©æ—§æ™‚é–“ï¼‰** | 4æ™‚é–“ | éšœå®³ç™ºç”Ÿã‹ã‚‰å¾©æ—§ã¾ã§ã®æ™‚é–“ |
| **RPOï¼ˆç›®æ¨™å¾©æ—§æ™‚ç‚¹ï¼‰** | 24æ™‚é–“ | è¨±å®¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æå¤±ã®ç¯„å›² |

#### 7.2.2 å¾©æ—§æ‰‹é †

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§**
```bash
# 1. Neon Dashboardã«ã‚¢ã‚¯ã‚»ã‚¹
# 2. Backupsã‚¿ãƒ–ã‚’é–‹ã
# 3. å¾©æ—§ãƒã‚¤ãƒ³ãƒˆã‚’é¸æŠ
# 4. Restoreãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
# 5. æ–°ã—ã„DATABASE_URLã‚’å–å¾—
# 6. Vercelã®ç’°å¢ƒå¤‰æ•°ã‚’æ›´æ–°
# 7. å†ãƒ‡ãƒ—ãƒ­ã‚¤
```

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¾©æ—§**
```bash
# 1. å‰å›ã®å®‰å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™
git revert <commit-hash>
git push origin main

# 2. VercelãŒè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

# 3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl https://f-gateway.vercel.app/api/health
```

---

## 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 8.1 æœ€é©åŒ–æˆ¦ç•¥

| é …ç›® | æœ€é©åŒ–æ‰‹æ³• | åŠ¹æœ |
|------|----------|------|
| **ç”»åƒ** | Next.js Imageæœ€é©åŒ– | è‡ªå‹•WebPå¤‰æ›ã€é…å»¶èª­ã¿è¾¼ã¿ |
| **ãƒ•ã‚©ãƒ³ãƒˆ** | Geist Sansãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | å¤–éƒ¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰Šæ¸› |
| **CSS** | Tailwind CSS purge | æœªä½¿ç”¨CSSã®å‰Šé™¤ |
| **API** | SWR + stale-while-revalidate | ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã€UXå‘ä¸Š |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ« | æ¥ç¶šã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰å‰Šæ¸› |
| **CSVå‡¦ç†** | ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç† | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸› |

### 8.2 ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

```typescript
// SWRã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
import useSWR from 'swr';

export function useClients() {
  const { data, error, isLoading } = useSWR(
    '/api/admin/clients',
    fetcher,
    {
      revalidateOnFocus: false,    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«å†æ¤œè¨¼ã—ãªã„
      revalidateOnReconnect: true, // å†æ¥ç¶šæ™‚ã«å†æ¤œè¨¼
      dedupingInterval: 5000,      // 5ç§’é–“ã¯é‡è¤‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ã
    }
  );

  return {
    clients: data?.clients,
    isLoading,
    isError: error,
  };
}
```

---

## 9. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è£œè¶³

### 9.1 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆParameterized Queryï¼‰
- [ ] XSSå¯¾ç­–ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã€CSPè¨­å®šï¼‰
- [ ] CSRFå¯¾ç­–ï¼ˆNextAuth.jsæ¨™æº–å¯¾å¿œï¼‰
- [ ] ClickJackingå¯¾ç­–ï¼ˆX-Frame-Optionsï¼‰
- [ ] HTTPSå¼·åˆ¶ï¼ˆVercelæ¨™æº–å¯¾å¿œï¼‰
- [ ] èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æš—å·åŒ–ï¼ˆNextAuth.jsæ¨™æº–å¯¾å¿œï¼‰
- [ ] APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆVercel Edge Middlewareï¼‰
- [ ] ç’°å¢ƒå¤‰æ•°ã®é©åˆ‡ãªç®¡ç†
- [ ] ç§˜å¯†æƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç¦æ­¢
- [ ] ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆnpm auditï¼‰

### 9.2 Content Security Policy

**next.config.js**
```javascript
const securityHeaders = [
  {
    key: 'X-DNS-Prefetch-Control',
    value: 'on',
  },
  {
    key: 'X-Frame-Options',
    value: 'SAMEORIGIN',
  },
  {
    key: 'X-Content-Type-Options',
    value: 'nosniff',
  },
  {
    key: 'Referrer-Policy',
    value: 'strict-origin-when-cross-origin',
  },
  {
    key: 'Content-Security-Policy',
    value: "default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline';",
  },
];

module.exports = {
  async headers() {
    return [
      {
        source: '/:path*',
        headers: securityHeaders,
      },
    ];
  },
};
```

---

## 10. é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 10.1 ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- **TypeScript**: å‹å®šç¾©ã‚’å¿…é ˆã¨ã™ã‚‹ï¼ˆ`any`ã®ä½¿ç”¨ç¦æ­¢ï¼‰
- **Linting**: ESLint + Prettier
- **å‘½åè¦å‰‡**:
  - ãƒ•ã‚¡ã‚¤ãƒ«å: kebab-caseï¼ˆä¾‹: `modern-header.tsx`ï¼‰
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCaseï¼ˆä¾‹: `ModernHeader`ï¼‰
  - é–¢æ•°: camelCaseï¼ˆä¾‹: `validateCSV`ï¼‰
  - å®šæ•°: UPPER_SNAKE_CASEï¼ˆä¾‹: `MAX_FILE_SIZE`ï¼‰

### 10.2 ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type:**
- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- `style`: ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `test`: ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»ä¿®æ­£
- `chore`: ãƒ“ãƒ«ãƒ‰ã€ãƒ„ãƒ¼ãƒ«è¨­å®šç­‰

**ä¾‹:**
```
feat(items): å•†å“ãƒã‚¹ã‚¿CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ 

- ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã§100MBå¯¾å¿œ
- é …ç›®ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

Closes #123
```

---

## 11. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [F-Gateway README](./README.md)
- [F-Gateway è¨­è¨ˆæ›¸](./è¨­è¨ˆæ›¸.md)
- [UIãƒ‡ã‚¶ã‚¤ãƒ³è¨­è¨ˆæ›¸](./UIãƒ‡ã‚¶ã‚¤ãƒ³è¨­è¨ˆæ›¸.md)
- [å•†å“ãƒã‚¹ã‚¿ç®¡ç†è¨­è¨ˆæ›¸](./å•†å“ãƒã‚¹ã‚¿ç®¡ç†è¨­è¨ˆæ›¸.md)

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | ç‰ˆæ•° | æ›´æ–°å†…å®¹ | æ›´æ–°è€… |
|------|------|---------|--------|
| 2026-01-28 | 1.0 | åˆç‰ˆä½œæˆã€‚APIè¨­è¨ˆã€ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³»ã€ç’°å¢ƒå¤‰æ•°ã€ãƒ†ã‚¹ãƒˆè¨­è¨ˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ã€ç›£è¦–ãƒ»é‹ç”¨ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è£œè¶³ã‚’è¿½åŠ  | Teppei & Claude |
| 2026-01-28 | 1.1 | Google Driveè¨­å®šã‚’4ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã«æ›´æ–°ï¼ˆå‡ºåº«äºˆå®š/å®Ÿç¸¾ã€å…¥åº«äºˆå®š/å®Ÿç¸¾ï¼‰ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ›´æ–° | Teppei & Claude |
